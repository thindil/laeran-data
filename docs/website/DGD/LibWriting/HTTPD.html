<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta name="generator" content=
  "HTML Tidy for Linux/x86 (vers 11 February 2007), see www.w3.org" />
  <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />

  <title>The Phantasmal MUDlib for DGD: HTTPD
</title>
  <link href="../../css/default.css" type="text/css" rel="stylesheet" />
</head>

<body>
  <div class="header_pane">
    <p>Phantasmal MUD Lib for DGD</p>

  </div>

  <div class="banner_pane">
    <table class="banner">
  <tr>
    <td class="banner" align="center"><a href=
    "http://validator.w3.org/check/referer"><img src=
    "http://www.w3.org/Icons/valid-xhtml10" alt=
    "Valid XHTML 1.0 Strict!" style=
    "border: 0; width: 88px; height: 31px;"></a> <a href=
    "http://jigsaw.w3.org/css-validator/check/referer"><img src=
    "http://jigsaw.w3.org/css-validator/images/vcss" alt=
    "Valid CSS!" style="border: 0; width: 88px; height: 31px;"></a>
    <a href="http://sourceforge.net"><img src=
    "http://sourceforge.net/sflogo.php?group_id=48659&amp;type=2"
    style="border: 0; width: 125px; height: 37px;" alt=
    "SourceForge.net Logo"></a></td>
  </tr>
</table>

  </div>

  <table>
    <tr>
      <td valign="top" class="index_pane">
        <ul>
<li><a href="../../index.html">Phantasmal Site</a></li>
<ul>
<li><a href="../../History.html">History</a></li>
<li><a href="../../Installing.html">Installing Baseline Phantasmal</a></li>
<li><a href="../../Comparison.html">Comparison to Other Libs</a></li>
<li><a href="../../Credits.html">Credits</a></li>
<li><a href="../../Current.html">Current Features</a></li>
<li><a href="../../WhatIsPhantasmal.html">About</a></li>
<li><a href="../../API/index.html">Phantasmal API</a></li>
<li><a href="../../Archive/index.html">Archive</a></li>
<li><a href="../../Design/index.html">Design</a></li>
<li><a href="../../Development/index.html">Development</a></li>
<li><a href="../index.html">DGD</a></li>
<ul>
<li><a href="../Manual/index.html">DGD Reference Manual</a></li>
<li><a href="../Contribute.html">Contributing to DGD</a></li>
<li><a href="../CSharp_vs_DGD.html">CSharp vs DGD</a></li>
<li><a href="../DGD_Terms.html">DGD Glossary</a></li>
<li><a href="../Java_vs_DGD.html">Java vs DGD</a></li>
<li><a href="../Misc_DGD.html">Miscellaneous DGD</a></li>
<li><a href="../MudOS_vs_DGD.html">MudOS vs DGD</a></li>
<li><a href="../MUDs_using_DGD.html">DGD MUDs</a></li>
<li><a href="../SlushBucket.html">Slush Bucket</a></li>
<li><a href="../Why_DGD.html">Why Use DGD?</a></li>
<li><a href="../Config/index.html">Getting DGD</a></li>
<li><a href="../GameDesign/index.html">Game Design Issues</a></li>
<li><a href="../Kernel/index.html">The Kernel Library</a></li>
<li><a href="index.html">Writing a Library</a></li>
<ul>
<li><a href="ChangingLPC.html">Changing LPC</a></li>
<li><a href="Cleanup.html">Object Cleanup</a></li>
<li><a href="CmdsOrNot.html">&frasl;cmd vs wiztool</a></li>
<li><a href="CondInherit.html">Conditional Inheritance</a></li>
<li><a href="Database.html">Object Database</a></li>
<li><a href="DistStateDump.html">Distribute a State Dump?</a></li>
<li><a href="DriverObj.html">Designing Driver Objs</a></li>
<li><a href="FTPD.html">FTPD</a></li>
<li><a href="GurbaLib.html">GurbaLib</a></li>
<li><a href="HeartBeat.html">State Dumps</a></li>
<li><a href="Heaven7.html">Heaven7</a></li>
<li>HTTPD</li>
<li><a href="IMUD3.html">InterMUD3</a></li>
<li><a href="InterruptCall.html">Interrupt Call</a></li>
<li><a href="LargeAuto.html">Designing AUTO Objs</a></li>
<li><a href="LittleIssues.html">Misc Issues</a></li>
<li><a href="NFS.html">NFS</a></li>
<li><a href="ObjBinding.html">Object Binding</a></li>
<li><a href="ObjectManagement.html">Object Management</a></li>
<li><a href="OtherServices.html">Other Net Services</a></li>
<li><a href="Persistence.html">Persistent MUDLibs</a></li>
<li><a href="PlayerBody.html">Player vs Body</a></li>
<li><a href="Precompiling.html">Precompiling</a></li>
<li><a href="Reimplementation.html">Reimplementing From Scratch</a></li>
<li><a href="Releasing.html">Releasing Code</a></li>
<li><a href="Rlimits.html">Rlimits</a></li>
<li><a href="ScriptDelays.html">Script Delays</a></li>
<li><a href="Security.html">Misc Security</a></li>
<li><a href="Sendmail.html">Outgoing Email</a></li>
<li><a href="SoYouWanna.html">So You Want To...</a></li>
<li><a href="StartingNew.html">Start from Scratch?</a></li>
<li><a href="SupDocs.html">Supplementary Documentation</a></li>
<li><a href="Telnet.html">Telnet Protocol</a></li>
<li><a href="UseKernel.html">Using the Kernel</a></li>
<li><a href="UseMelville.html">Using Melville</a></li>
<li><a href="UsePhantasmal.html">Using Phantasmal</a></li>
<li><a href="WebDAV.html">WebDAV</a></li>
<li><a href="WhatLicense.html">Which License</a></li>
</ul>
<li><a href="../LPC/index.html">Untitled document (LPC/index.base.html)</a></li>
<li><a href="../Operation/index.html">What Does It Do?</a></li>
<li><a href="../Programming/index.html">DGD LPC Reference</a></li>
<li><a href="../Running/index.html">Running a MUD</a></li>
<li><a href="../Skotos/index.html">Skotos</a></li>
</ul>
<li><a href="../../Innsmouth/index.html">Innsmouth MUD</a></li>
<li><a href="../../Operation/index.html">Phantasmal Operation</a></li>
<li><a href="../../Setup/index.html">Setup</a></li>
<li><a href="../../Test/index.html">Test module index</a></li>
<li><a href="../../Tutorial/index.html">Phantasmal Tutorials</a></li>
</ul>
</ul>

      </td>
      <td valign="top" class="content_pane">
        <p><a href="index.html">Phantasmal Site</a> > <a href="index.html">DGD</a> > <a href="index.html">Writing a Library</a> > HTTPD</p>



<h2>Writing an HTTPD in DGD</h2>

<p>If you write an HTTPD that can read files in your MUD (as
opposed to one that presents an entirely different file model,
something it makes up), remember not to let people randomly get
code out of your MUD directories. Be sure to only send out the
files you intend people to get. Be careful to normalize filenames
first (remove leading '..' paths, et cetera) so that nobody can
fool you by using a different path format. This helps to keep your
HTTPD from causing security problems in your MUD.</p>

<p>You can also allow players to play over HTTP, or some related
protocol. If so, please remember <i>not</i> to identify your
players by IP address. Issues like firewalls and NAT can greatly
confuse your MUD server, causing multiple players to be treated as
one, or a player to suddenly lose connection when he appears to
change IP addresses. Cookies are one of several more reliable
tracking methods, though there are certainly others.</p>

<p>Bear in mind that standard HTTP does not allow 'push' code for
things like 'tell' and 'say', nor for sudden events like a creature
entering a room and attacking. For that reason, Java (or
Javascript?) or some more proprietary replacement like ActiveX may
be necessary to allow your MUD proper two-way interactivity.</p>

<p>More complex setups can work quite well, of course. Christopher
Allen describes the Skotos setup like this:</p>

<p style="color: #FF00C0">You might want to take a look at a couple
of Skotos games, in particular, Castle Marrach and Grendel's
Revenge. Both have gifs and jpegs under client control.</p>

<p style="color: #FF00C0">Our basic technique is to have a pane for
flowing text that is imbedded inside an html page. This text pane
can receive special commands that it will send out to the DOM of
the web page it sits inside. This allows us to change the whole web
page dynamically. We have three clients that use this technique, an
Active-X client that is based on Pueblo, a Java client, and a
Mozilla Javascript client.</p>

<p>The RFC for HTTP 1.0 is <a href=
"http://www.ics.uci.edu/pub/ietf/http/rfc1945.html">here</a>. It
may be useful for your implementation efforts.</p>

<p>To set cookies, you may find Javascript is useful. The following
script was obtained by Wes Connell off a Javascript help page:</p>
<pre>
&lt;script language="JavaScript"&gt;
&lt;!--

&frasl;&frasl; Use this function to retrieve a cookie.
function getCookie(name){
var cname = name + "=";
var dc = document.cookie;
    if (dc.length &gt; 0) {
    begin = dc.indexOf(cname);
        if (begin != -1) {
        begin += cname.length;
        end = dc.indexOf(";", begin);
            if (end == -1) end = dc.length;
            return unescape(dc.substring(begin, end));
        }
    }
return null;
}

&frasl;&frasl; Use this function to save a cookie.
function setCookie(name, value) {
document.cookie = name + "=" + escape(value) + "; path=&frasl;";
}

&frasl;&frasl; Use this function to delete a cookie.
function delCookie(name) {
document.cookie = name + "=; expires=Thu, 01-Jan-70 00:00:01 GMT" +  "; path=&frasl;";
}
&frasl;&frasl;--&gt;
&lt;&frasl;script&gt;
  
</pre>

<p>Using the above, the following code can be included:</p>
<pre>
send_html_output("&lt;script language="JavaScript"&gt;);
send_html_output("setCookie(\"ACCOUNTNAME\", account_name);");
send_html_output("setCookie(\"PASSWORD\", encrypted_password);");
send_html_output("&lt;&frasl;script&gt;");
  
</pre>
<hr>
<pre>
From: Bart van Leeuwen
Subject: [DGD] DGD http daemon?
Date: Tue Feb  8 20:58:01 2005

Hey,

Last week I rewrote a small http serving object from my mud into a
relatively complete http server.

You can see it in action by pointing your browser at http://mud.wotf.org/

Currently the code is somewhat specific to my kernel (and modified driver)
but if people are interested in this and someone is willing to help test
it for a generic DGD kernel then I can make the code available
(for non commercial use only however)

A somewhat preliminary README can be found at
http://mud.wotf.org/httpd.html, which provides some info on what it
supports and how it works.

Bart.

ps. in the next 1 1/2 weeks I'll be rather busy and away from home, I will
read my mail, but I won't be able to finish the cleaning up of the code. I do want to get an
idea on if I should put in the efford to remove dependencies on my own
kernel however.
</pre>
<hr>
<pre>
From: Joakim Romland
Subject: Re: [DGD] DGD http daemon?
Date: Wed Feb  9 00:30:01 2005

On Tue, 8 Feb 2005 15:26:53 -0500 (EST), Stephen Schmidt wrote:
&gt; There are all kinds of design-related problems with using
&gt; a primarily http interface for playing the game; those
&gt; don't interest me so much. The question is really whether
&gt; this daemon could be the basis for code support for such
&gt; a design. If it is, then having a version for a general
&gt; DGD kernel (or even a specific kernel that could be
&gt; released as a package with the daemon) would be extremely
&gt; useful.
&gt;
I tinkered (and still touch it when I get some inspiration) with a
httpd that is built on top of the Kernel Library. It's somewhat more
bloated and should really be divided into several sub-projects. I
wrote it mostly to create a WebDAV daemon -- but I needed a httpd for
that (see SVN repository at
http://developer.berlios.de/projects/dgd-httpd/)

Either way, you can do some trickery with the xmlHttp object that is
available in most browsers these days. But as always with HTTP, you
need to do polling to get new state. Although, if you have support for
keep-alive sessions in your httpd you poll through the same connection
all the time (if you poll more often than the timeout is set to that
is).

I tested this using xmlHttp some time back using the above httpd to
write a web-chat... And sure, you get a delay of a couple of seconds
(depending on how often you poll), but to the user (browser) it is
completely invisible; eg. new information just pops up. You can poll
quite a few times per second if you want to too, but HTTP headers give
you a quite a bit of overhead. :-)

It is limited in its usefulness, but I can imagine the creative person
can come up with some nifty stuff.

If you have no idea what I am talking about, then I have relevant
snippet of the client code here (if you want the backend as well, just
drop me a mail -- it's not much code):

[ snip ]
    function createXmlHttp() {
        /* Only support for Mozilla atm. */
        return new XMLHttpRequest();
    }

    function result() {
        if(xmlHttp.readyState == 4 &amp;&amp; xmlHttp.responseText) {
            currentBuff.innerHTML = xmlHttp.responseText;
        }
    }

    function fetch() {
        if(xmlHttp &amp;&amp; xmlHttp.readyState != 0) {
            xmlHttp.abort();
        }

        if(xmlHttp = createXmlHttp()) {
            xmlHttp.open("GET", urlServer + urlGetPath + "?since=1", true);
            xmlHttp.onreadystatechange = result;
        } else {
            DEBUG("Failed to create xmlHttp");
        }

        xmlHttp.send(null);
    }

    function send(msg) {
        if(xmlHttp &amp;&amp; xmlHttp.readyState != 0) {
            xmlHttp.abort();
        }

        if(xmlHttp = createXmlHttp()) {
            xmlHttp.open("GET", urlServer + urlSendPath + "?since=1&amp;message=" +
msg, true);
            xmlHttp.onreadystatechange = result;
        } else {
            DEBUG("Failed to create xmlHttp");
        }

        xmlHttp.send(null);
    }

    function main() {
        fetch();
        setTimeout("main()", refreshRate);
    }

[ /snip ]


// Joakim
</pre>
<hr>
<pre>
From: Bart van Leeuwen
Subject: Re: [DGD] DGD http daemon?
Date: Wed Feb  9 00:43:01 2005

On Tue, 8 Feb 2005, [ISO-8859-1] Petter Nystr√∂m wrote:

&gt; If you are releasing the code, I'd be interested in using it. I am not
&gt; running Dworkin's kernel lib though, so I can't really help you getting a
&gt; generic version of the code. I am just a fellow lib coder who have often
&gt; thought it'd be nice to have an internal web server for the simpler
&gt; purposes that have been mentioned, but I have never given the project
&gt; priority. With your code, I can't believe there would be that much work to
&gt; integrate it into my mudlib.

If you know how your kernel's user/connection handling is working then
you should have little trouble getting this to work on your kernel.

&gt;
&gt; If you put the code in public domain, let us know!

It will be available for non-commercial use once I cleaned it up a bit and
have a little bit more documentation for interfacing with it (which should
take some 2 weeks due to me being away from home for a while)

As a sidenote, there is also a project at
http://developer.berlios.de/projects/dgd-httpd/ which provides a (for what
I can tell more heavyweight) http server for DGD. If you need things like
XML parsing or webdav, take a look at that as well. What I have written is
extremely minimalistic in comparison.

Bart.
</pre>

      </td>
    </tr>
  </table>

  <div class="footer_pane">
    <p>Copyright (C) 2010 Raymond Jennings</p>

<p>This website is released to the public under the terms of the
GNU Free Documentation License, Version 1.3 or later</p>

  </div>
</body>
</html>
