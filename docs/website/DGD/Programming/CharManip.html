<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta name="generator" content=
  "HTML Tidy for Linux/x86 (vers 11 February 2007), see www.w3.org" />
  <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />

  <title>The Phantasmal MUDlib for DGD: Character Manipulation
</title>
  <link href="../../css/default.css" type="text/css" rel="stylesheet" />
</head>

<body>
  <div class="header_pane">
    <p>Phantasmal MUD Lib for DGD</p>

  </div>

  <div class="banner_pane">
    <table class="banner">
  <tr>
    <td class="banner" align="center"><a href=
    "http://validator.w3.org/check/referer"><img src=
    "http://www.w3.org/Icons/valid-xhtml10" alt=
    "Valid XHTML 1.0 Strict!" style=
    "border: 0; width: 88px; height: 31px;"></a> <a href=
    "http://jigsaw.w3.org/css-validator/check/referer"><img src=
    "http://jigsaw.w3.org/css-validator/images/vcss" alt=
    "Valid CSS!" style="border: 0; width: 88px; height: 31px;"></a>
    <a href="http://sourceforge.net"><img src=
    "http://sourceforge.net/sflogo.php?group_id=48659&amp;type=2"
    style="border: 0; width: 125px; height: 37px;" alt=
    "SourceForge.net Logo"></a></td>
  </tr>
</table>

  </div>

  <table>
    <tr>
      <td valign="top" class="index_pane">
        <ul>
<li><a href="../../index.html">Phantasmal Site</a></li>
<ul>
<li><a href="../../History.html">History</a></li>
<li><a href="../../Installing.html">Installing Baseline Phantasmal</a></li>
<li><a href="../../Comparison.html">Comparison to Other Libs</a></li>
<li><a href="../../Credits.html">Credits</a></li>
<li><a href="../../Current.html">Current Features</a></li>
<li><a href="../../WhatIsPhantasmal.html">About</a></li>
<li><a href="../../API/index.html">Phantasmal API</a></li>
<li><a href="../../Archive/index.html">Archive</a></li>
<li><a href="../../Design/index.html">Design</a></li>
<li><a href="../../Development/index.html">Development</a></li>
<li><a href="../index.html">DGD</a></li>
<ul>
<li><a href="../Manual/index.html">DGD Reference Manual</a></li>
<li><a href="../Contribute.html">Contributing to DGD</a></li>
<li><a href="../CSharp_vs_DGD.html">CSharp vs DGD</a></li>
<li><a href="../DGD_Terms.html">DGD Glossary</a></li>
<li><a href="../Java_vs_DGD.html">Java vs DGD</a></li>
<li><a href="../Misc_DGD.html">Miscellaneous DGD</a></li>
<li><a href="../MudOS_vs_DGD.html">MudOS vs DGD</a></li>
<li><a href="../MUDs_using_DGD.html">DGD MUDs</a></li>
<li><a href="../SlushBucket.html">Slush Bucket</a></li>
<li><a href="../Why_DGD.html">Why Use DGD?</a></li>
<li><a href="../Config/index.html">Getting DGD</a></li>
<li><a href="../GameDesign/index.html">Game Design Issues</a></li>
<li><a href="../Kernel/index.html">The Kernel Library</a></li>
<li><a href="../LibWriting/index.html">Writing a Library</a></li>
<li><a href="../LPC/index.html">Untitled document (LPC/index.base.html)</a></li>
<li><a href="../Operation/index.html">What Does It Do?</a></li>
<li><a href="index.html">DGD LPC Reference</a></li>
<ul>
<li><a href="AbstractFuncs.html">DGD/MP and Threads</a></li>
<li><a href="Arrays.html">Mappings</a></li>
<li><a href="AtomicFuncs.html">Atomic Functions</a></li>
<li><a href="Calling_Conventions.html">DGD Calling Conventions</a></li>
<li><a href="CallOut.html">call_out</a></li>
<li><a href="CallTouch.html">call_touch()</a></li>
<li><a href="CallTrace.html">call_trace()</a></li>
<li>Character Manipulation</li>
<li><a href="Code_Examples.html">LPC Code Samples</a></li>
<li><a href="CreateFuncs.html">Create Funcs</a></li>
<li><a href="Diffs_in_LPC.html">DGD LPC Diffs</a></li>
<li><a href="Driver_Details.html">DGD Driver Details</a></li>
<li><a href="General_Docs.html">non-DGD Docs</a></li>
<li><a href="LinkedLists.html">Linked Lists</a></li>
<li><a href="LPC_FAQ.html">LPC FAQ</a></li>
<li><a href="Mappings.html">Mappings</a></li>
<li><a href="MPThreads.html">DGD/MP and Threads</a></li>
<li><a href="Object_Types.html">DGD Object Subtypes</a></li>
<li><a href="Parse_String.html">Using parse_string</a></li>
<li><a href="SPrintF.html">sprintf in DGD</a></li>
<li><a href="SScanF.html">sscanf in DGD</a></li>
<li><a href="ThreadLocal.html">Thread-Local Storage</a></li>
<li><a href="Unsupported.html">Unsupported Features</a></li>
</ul>
<li><a href="../Running/index.html">Running a MUD</a></li>
<li><a href="../Skotos/index.html">Skotos</a></li>
</ul>
<li><a href="../../Innsmouth/index.html">Innsmouth MUD</a></li>
<li><a href="../../Operation/index.html">Phantasmal Operation</a></li>
<li><a href="../../Setup/index.html">Setup</a></li>
<li><a href="../../Test/index.html">Test module index</a></li>
<li><a href="../../Tutorial/index.html">Phantasmal Tutorials</a></li>
</ul>
</ul>

      </td>
      <td valign="top" class="content_pane">
        <p><a href="index.html">Phantasmal Site</a> > <a href="index.html">DGD</a> > <a href="index.html">DGD LPC Reference</a> > Character Manipulation</p>



<h2>Manipulating Character Strings</h2>
<hr>
<pre>
Date: Fri, 30 Mar 2001 01:57:32 +0200
From: Erwin Harte
Subject: Re: [DGD]Adding character to string

On Fri, Mar 30, 2001 at 01:30:43AM +0200, Frantisek Fuka wrote:
&gt; I have this problem with DGD 1.2. The solution is probably very simple 
&gt; but I couldn't come up with anything elegant and it drives me mad.
&gt; 
&gt; I need to be able to get the character according to its ASCII number. 
&gt; For example, if I have string str = "foo" and integer num = 65, i need 
&gt; to somehow do (str + (char)num) and get "fooA", but I keep getting 
&gt; "foo65" and I can find no function to convert 65 to "A". I know it can 
&gt; be done by doing
&gt; str = "foo?"; str [3] = num; /* replaces '?' with 'A' */

Right, so what about:

    string
    chr(int c)
    {
	string s;

	s = " ";
	s[0] = c;
	return s;
    }

I agree, a bit of overhead, but once you've got that, it's very
elegant to be doing

    str += chr(65);

and have it work as intended.

&gt; but that seems cumbersome to me. Specifically, I need to use the 
&gt; following function for translating all output from one character coding 
&gt; to other so it has to be quick and elegant (it also adds '\x0D' before 
&gt; each "\n" because i use binary port for output):
&gt; 
&gt; string out;
&gt; out = "";
&gt; for (i=0; i&lt;strlen(msg); i++) {
&gt; if (msg[i] == '\n') out += '\x0D';
&gt; out += (msg[i] &gt;= 128) ? charset_output[msg[i]-128] : msg[i];
&gt; }
&gt; 
&gt; Unfortunately, instead of character (for example 'A'), the string "65" 
&gt; is being added to 'out' variable.

The reason for this is that the 'x' constants are really int values,
so what the compiler thinks you're doing is:

    &lt;string&gt; = &lt;string&gt; + &lt;int&gt;;

Which means you get:

    &lt;string&gt; = &lt;string&gt; + (string)&lt;int&gt;

So the compiler is doing what you're telling it to, not what you want
it to. ;-)

I'd do it this way:

    int    i, len;
    string out;

    out = implode(explode("\n" + msg + "\n", "\n"), "\r\n");
    for (i = 0, len = strlen(out); i &lt; len; i++) {
        out[i] &amp;= 0x7f;
    }

Hope that helps,

Erwin.
-- 
Erwin Harte      : `Don't mind Erwin, he gets crabby. :)'
</pre>
<hr>
<pre>
Date: Fri, 30 Mar 2001 02:59:04 +0200
From: Erwin Harte
Subject: Re: [DGD]Adding character to string

On Fri, Mar 30, 2001 at 01:57:32AM +0200, Erwin Harte wrote:
&gt; On Fri, Mar 30, 2001 at 01:30:43AM +0200, Frantisek Fuka wrote:
[...]
&gt; 
&gt; I'd do it this way:
&gt; 
&gt;     int    i, len;
&gt;     string out;
&gt; 
&gt;     out = implode(explode("\n" + msg + "\n", "\n"), "\r\n");
&gt;     for (i = 0, len = strlen(out); i &lt; len; i++) {
&gt;         out[i] &amp;= 0x7f;
&gt;     }

Silly me, there I went and ignored the charset_output(..) function
you're using.  Replace the 'out[i] &amp;= 0x7f' with:

          if (out[i] &amp; 0x80) {
              out[i] = charset_output(out[i] - 0x80);
          }

An alternative approach (which, I should say, was suggested by Dworkin
and not one I came up with) would be to use parse_string() with a
grammar like this:

    lo = /[\x00-\x7f]+/
    hi = /[\x00-\x7f]+/

    text = chunks chunk
    text = chunk

    chunk = lo
    chunk = hi ? convert_output

Where convert_output would be a function like this:

    string
    convert_output(mixed *tree)
    {
        int i, len;
        string str;

        str = tree[0];
        for (i = 0, len = strlen(str); i &lt; len; i++) {
            str[i] = charset_output(str[i] - 0x80);
        }
        return ({ str });
    }

The two functions required for the text grammar-rules are left as an
exercise to the reader. ;-)

Erwin.
-- 
Erwin Harte      : `Don't mind Erwin, he gets crabby. :)'
</pre>
<hr>
<pre>
From: dgd at list.imaginary.com (Kris Van Hees)
Date: Wed Nov 26 15:40:04 2003
Subject: [DGD] string indexing..

I believe this is intentional behaviour, to be sonsistent in how string ranges
can work.  The str[i .. i + 1] construct returns a string that is 2 characters
long (assuming strlen(str) &gt; i  + 1 of course), str[i .. i] returns a string
that is 1 character long, and this str[i .. i - 1] returns a string that is 0
characters long.  It does make sense if you look at it that way.

	Kris

On Wed, Nov 26, 2003 at 10:36:05PM +0000, Bart van Leeuwen wrote:
&gt; Hmm.. it seems to me that doing something like "blah"[0..-1] should result
&gt; in an invalid string range error, but it does not, it results in an empty
&gt; string (checked on dgd 1.1, 1.2p3).
&gt; 
&gt; Looking through str.c in various versions points at str_ckrange and
&gt; str_range.
&gt; The particular issue is checking on l1 &gt; l2 + 1, which should either be
&gt; l1 &gt; l2 or l1 &gt;= l2 + 1 (why would you write it like that anyway?)
&gt; 
&gt; Was wondering for a sec if it was a feature, but theres cleaner ways to
&gt; get an empty string I figured so I guess it is a bug :)
&gt; 
&gt; Btw, I ended up there because I wanted to get indexing from the end of a
&gt; string working (ie, str[0..-3] is short for str[0..strlen(str)-3] (oh, and
&gt; a bit faster also of course), and besides, I like the driver just
&gt; returning an empty string instead of throwing a runtime error when trying
&gt; to index past the end of the string ;) (and I ended up there due to
&gt; wanting a much closer emulation of lpmud, but more about that later maybe)
&gt; 
&gt; Anyway, if people are interested I will cleanup the code for it a bit and
&gt; make a patch available. It seems to work with all I threw at it, but
&gt; wasn't tested very extensively yet.
&gt; 
&gt; Bart.
</pre>

      </td>
    </tr>
  </table>

  <div class="footer_pane">
    <p>Copyright (C) 2010 Raymond Jennings</p>

<p>This website is released to the public under the terms of the
GNU Free Documentation License, Version 1.3 or later</p>

  </div>
</body>
</html>
